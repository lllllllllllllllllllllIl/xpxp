-- Services
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")

-- Safe clipboard copy (some executors may not have setclipboard)
local function safeSetClipboard(text)
    if setclipboard then
        pcall(setclipboard, text)
    end
end

-- Get "HWID" (client identifier)
local function getHWID()
    -- Note: GetClientId is not a cryptographically secure HWID; it can change or be spoofed.
    local success, clientId = pcall(function()
        return game:GetService("RbxAnalyticsService"):GetClientId()
    end)
    if success and clientId then
        return clientId
    end
    return nil
end

-- Fetch and load the allowed HWID list
local function fetchAllowedHWIDs()
    local url = "https://raw.githubusercontent.com/lllllllllllllllllllllIl/xpxp/refs/heads/main/hwids"
    local ok, body = pcall(function()
        return HttpService:GetAsync(url)
    end)
    if not ok or not body then
        warn("Failed to download HWID list.")
        return nil
    end

    local loaded, result = pcall(function()
        return loadstring(body)()
    end)
    if not loaded or type(result) ~= "table" then
        warn("HWID list is invalid or not a table.")
        return nil
    end

    return result
end

-- Simple membership test
local function isAllowed(hwid, allowedList)
    for _, v in ipairs(allowedList) do
        if v == hwid then
            return true
        end
    end
    return false
end

-- Main logic
local hwid = getHWID()
if not hwid then
    warn("Failed to retrieve HWID.")
    return
end

print("Your HWID: " .. hwid)
safeSetClipboard(hwid)

local allowedHWIDs = fetchAllowedHWIDs()
if not allowedHWIDs then
    return
end

if not isAllowed(hwid, allowedHWIDs) then
    -- Optional: log unauthorized attempt here
    if Players.LocalPlayer then
        Players.LocalPlayer:Kick("Unauthorized HWID")
    end
    return
end

-- HWID is allowed; execute the main script
local success, err = pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/lllllllllllllllllllllIl/xpxp/refs/heads/main/mc"))()
end)
if not success then
    warn("Failed to execute main script:", err)
end
